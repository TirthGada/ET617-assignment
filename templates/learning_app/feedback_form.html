<div class="card" style="padding:20px; margin-bottom:20px; border:1px solid #ddd;">
    <h3>Submit Feedback</h3>
    <form id="feedback-form">
      <input type="hidden" name="course" value="{{ content.course.id }}">
      <input type="hidden" name="content" value="{{ content.id }}">
  
      <label>Rating (1–5):</label>
      <input type="number" name="rating" min="1" max="5" required><br><br>
  
      <label>Clarity:</label>
      <select name="clarity">
        <option value="easy">Easy</option>
        <option value="moderate">Moderate</option>
        <option value="difficult">Difficult</option>
      </select><br><br>
  
      <label>Engagement:</label>
      <select name="engagement">
        <option value="boring">Boring</option>
        <option value="okay">Okay</option>
        <option value="engaging">Engaging</option>
      </select><br><br>
  
      <label>Instructor Rating (1–5):</label>
      <input type="number" name="instructor_rating" min="1" max="5"><br><br>
  
      <label>Comment:</label>
      <textarea name="comment" rows="3" cols="40"></textarea><br><br>
  
      <label>
        <input type="checkbox" name="anonymous" value="true">
        Submit anonymously
      </label><br><br>
  
      <button type="submit">Submit Feedback</button>
    </form>
  
    <p id="feedback-msg" style="color: green; display: none;">✅ Feedback submitted successfully!</p>
  </div>
  
  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');
  
    document.getElementById("feedback-form").addEventListener("submit", function(e) {
      e.preventDefault();
  
      const formData = new FormData(this);
      const data = {};
      formData.forEach((value, key) => {
        if (key === "anonymous") {
          data[key] = true;
        } else {
          data[key] = value;
        }
      });
  
      fetch("/api/feedback/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken
        },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) throw new Error("Failed to submit feedback");
        return res.json();
      })
      .then(() => {
        document.getElementById("feedback-msg").style.display = "block";
        document.getElementById("feedback-form").reset();
      })
      .catch(err => alert(err));
    });
  </script>
  